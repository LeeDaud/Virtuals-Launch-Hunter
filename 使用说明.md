# V3.1.0 使用说明

## 1. 安装与启动
1. 安装依赖
```powershell
cd virtual
python -m pip install -r requirements.txt
```

2. 准备配置
```powershell
copy .\config.example.json .\config.json
```

3. 至少填写这 3 项
- `WS_RPC_URL`
- `HTTP_RPC_URL`
- `BACKFILL_HTTP_RPC_URL`

4. 一键启动三进程
```powershell
.\start_3roles.ps1
```

5. 打开页面
- `http://127.0.0.1:8080/`

## 2. V3.1.0 新增指标说明
页面 KPI 区新增：`项目累计税收(V)`。

该数值表示：
- 当前选中项目下，所有有效交易中转入该项目税收地址（`tax_addr`）的 `V` 累计总和。

## 3. API 查询方式
```http
GET /project-tax?project=WORK
```

示例返回：
```json
{
  "project": "WORK",
  "sum_tax_v": "1234.567890000000000000",
  "updated_at": 1770988888
}
```

## 4. 使用建议
- 若切换项目后该指标为 0，请先确认该项目有有效交易。
- 若你刚从旧版本升级，第一次查询会有一次历史汇总，之后会走增量更新。
- 实时、自动回扫、手动回扫都会影响此值。

## 5. 常见问题
1. 指标不变
- 检查当前是否选中了正确项目。
- 检查该项目 `tax_addr` 配置是否正确。

2. 启动报 `10048` 端口占用
- 停掉旧 writer 进程，或在 `config.json` 修改 `API_PORT`。

3. 回扫失败
- 若提示 `eth_getLogs is limited`，降低 `BACKFILL_CHUNK_BLOCKS`（例如 `10 -> 5`）。
